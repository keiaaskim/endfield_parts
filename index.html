ë“œë””ì–´ ëª¨ë“  í¼ì¦ ì¡°ê°ì´ ëª¨ì˜€ìŠµë‹ˆë‹¤! ì œê³µí•´ì£¼ì‹  ë‘ ê°œì˜ ì‹¤ì‹œê°„ CSV ì£¼ì†Œë¥¼ ì—°ë™í•˜ì—¬, ë¯¸ë³´ìœ  ë¬´ê¸° ì¤‘ ì¢…ê²° ê¸°ì§ˆì„ ì–»ì„ í™•ë¥ ì´ ê°€ì¥ ë†’ì€ ì§€ì—­ê³¼ ì¡°í•©ì„ ì°¾ì•„ë‚´ëŠ” ìµœì¢… ì½”ë“œë¥¼ ì™„ì„±í–ˆìŠµë‹ˆë‹¤.

ì´ ì½”ë“œëŠ” ì‚¬ìš©ìë‹˜ì´ ì§ì ‘ parts_listë¥¼ ì¼ì¼ì´ ëŒ€ì¡°í•˜ì§€ ì•Šì•„ë„, í˜„ì¬ ì¸ë²¤í† ë¦¬ì— ì—†ëŠ” ì¡°í•©ì„ ìë™ìœ¼ë¡œ ê³„ì‚°í•˜ì—¬ ìµœì ì˜ íŒŒë°ì§€ë¥¼ ì¶”ì²œí•´ ì¤ë‹ˆë‹¤.

ğŸ› ï¸ ìµœì¢… index.html ì½”ë“œ
ì•„ë˜ ì½”ë“œë¥¼ ë³µì‚¬í•´ì„œ ê¹ƒí—ˆë¸Œì˜ index.html íŒŒì¼ì— ë®ì–´ì“°ê¸° í•˜ì„¸ìš”. (ì´ë¯¸ ì£¼ì†Œë“¤ì„ ì½”ë“œ ì•ˆì— ë„£ì–´ë‘ì—ˆìŠµë‹ˆë‹¤.)

HTML
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì—”ë“œí•„ë“œ íŒŒë° ìµœì í™” ë„êµ¬</title>
    <style>
        :root { --bg: #1a1a1a; --card: #2d2d2d; --text: #e0e0e0; --accent: #fbac24; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 600px; }
        .card { background: var(--card); padding: 25px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { font-size: 1.5rem; margin-bottom: 20px; text-align: center; color: var(--accent); }
        .btn { background: var(--accent); color: #000; padding: 15px; border: none; border-radius: 12px; font-weight: bold; width: 100%; cursor: pointer; transition: 0.2s; font-size: 1rem; }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .result-section { margin-top: 25px; display: none; border-top: 1px solid #444; padding-top: 20px; }
        .res-item { margin-bottom: 15px; font-size: 1.1rem; }
        .label { color: #aaa; font-size: 0.9rem; display: block; margin-bottom: 4px; }
        .value { font-weight: 700; color: #fff; }
        .tag { display: inline-block; background: #444; padding: 4px 10px; border-radius: 6px; margin-right: 5px; margin-top: 5px; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>ğŸš€ íŒŒë° ìµœì  ì§€ì—­ ìŠ¤ìºë„ˆ</h1>
            <button class="btn" onclick="runAnalysis()">ì‹¤ì‹œê°„ ë°ì´í„° ë¶„ì„ ì‹œì‘</button>
            
            <div id="result" class="result-section">
                <div class="res-item">
                    <span class="label">ì¶”ì²œ íŒŒë° ì§€ì—­</span>
                    <span id="best-area" class="value" style="font-size: 1.4rem; color: var(--accent);"></span>
                </div>
                <div class="res-item">
                    <span class="label">ê³ ì •í•  ì†ì„± (ì¶”ê°€/ìŠ¤í‚¬ ì¤‘ íƒ 1)</span>
                    <span id="best-fixed" class="value"></span>
                </div>
                <div class="res-item">
                    <span class="label">ì¶”ì²œ ê¸°ì´ˆì†ì„± 3ì¢…</span>
                    <div id="best-bases"></div>
                </div>
                <div id="summary" style="font-size: 0.9rem; color: #888; margin-top: 10px;"></div>
            </div>
        </div>
    </div>

    <script>
        const WEAPON_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSvCoDDcCH_LVoRliGUwW0cAGOJtps8Ucmjj_ENOJxSuyGowRtq2heV5jh8VkVVTnwCoguGecjAkT6v/pub?gid=1336240927&single=true&output=csv";
        const PARTS_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSvCoDDcCH_LVoRliGUwW0cAGOJtps8Ucmjj_ENOJxSuyGowRtq2heV5jh8VkVVTnwCoguGecjAkT6v/pub?gid=545530430&single=true&output=csv";

        async function runAnalysis() {
            try {
                const [wRes, pRes, aRes] = await Promise.all([
                    fetch(WEAPON_CSV), fetch(PARTS_CSV), fetch('areas.json')
                ]);
                
                const weapons = parseCSV(await wRes.text());
                const inventory = parseCSV(await pRes.text());
                const areas = await aRes.json();

                // 1. ë‚´ê°€ í˜„ì¬ 'ê°€ì§€ê³  ìˆì§€ ì•Šì€' ì¢…ê²° ê¸°ì§ˆ ë¦¬ìŠ¤íŠ¸ íŒŒì•…
                const neededGears = weapons.filter(w => {
                    // ì¸ë²¤í† ë¦¬ì— ê¸°ì´ˆ/ì¶”ê°€/ìŠ¤í‚¬ 3ê°œê°€ ëª¨ë‘ ì¼ì¹˜í•˜ëŠ” ë°ì´í„°ê°€ ìˆëŠ”ì§€ í™•ì¸
                    const hasIt = inventory.some(p => 
                        p['ê¸°ì´ˆì†ì„±'] === w['ê¸°ì´ˆì†ì„±'] && 
                        p['ì¶”ê°€ì†ì„±'] === w['ì¶”ê°€ì†ì„±'] && 
                        p['ìŠ¤í‚¬ì†ì„±'] === w['ìŠ¤í‚¬ì†ì„±']
                    );
                    return !hasIt;
                });

                if (neededGears.length === 0) {
                    alert("ëª¨ë“  ì¢…ê²° ê¸°ì§ˆì„ ë³´ìœ  ì¤‘ì…ë‹ˆë‹¤! ğŸ‰");
                    return;
                }

                // 2. ëª¨ë“  ì§€ì—­/ì†ì„± ì¡°í•© ì‹œë®¬ë ˆì´ì…˜
                let bestResult = { score: -1 };

                areas.forEach(area => {
                    const allPossibleFixed = [...new Set([...area.extra, ...area.skill])];
                    
                    allPossibleFixed.forEach(fixedAttr => {
                        // í˜„ì¬ ì§€ì—­+ê³ ì •ì†ì„±ì—ì„œ ë‚˜ì˜¬ ìˆ˜ ìˆëŠ” 'í•„ìš”í•œ ë¬´ê¸°'ë“¤
                        const matchableWeapons = neededGears.filter(w => {
                            const canBase = area.base.includes(w['ê¸°ì´ˆì†ì„±']);
                            const canFixed = (w['ì¶”ê°€ì†ì„±'] === fixedAttr || w['ìŠ¤í‚¬ì†ì„±'] === fixedAttr);
                            return canBase && canFixed;
                        });

                        if (matchableWeapons.length > 0) {
                            // ì´ ì¡°í•©ì—ì„œ ê°€ì¥ ë‹¹ì²¨ í™•ë¥ ì„ ë†’ì—¬ì¤„ ê¸°ì´ˆì†ì„± 3ì¢… ê³„ì‚°
                            const baseCounts = {};
                            matchableWeapons.forEach(w => {
                                baseCounts[w['ê¸°ì´ˆì†ì„±']] = (baseCounts[w['ê¸°ì´ˆì†ì„±']] || 0) + 1;
                            });
                            const topBases = Object.entries(baseCounts)
                                .sort((a,b) => b[1] - a[1])
                                .slice(0, 3)
                                .map(e => e[0]);

                            // ì ìˆ˜ ê³„ì‚°: ê¸°ì´ˆ 3ì¢…ì— í¬í•¨ëœ ë¬´ê¸° ìˆ˜
                            const finalScore = matchableWeapons.filter(w => topBases.includes(w['ê¸°ì´ˆì†ì„±'])).length;

                            if (finalScore > bestResult.score) {
                                bestResult = {
                                    area: area.name,
                                    fixed: fixedAttr,
                                    bases: topBases,
                                    score: finalScore
                                };
                            }
                        }
                    });
                });

                // 3. ê²°ê³¼ ë Œë”ë§
                document.getElementById('result').style.display = 'block';
                document.getElementById('best-area').innerText = bestResult.area || "ë°ì´í„° ì—†ìŒ";
                document.getElementById('best-fixed').innerText = bestResult.fixed || "-";
                document.getElementById('best-bases').innerHTML = (bestResult.bases || [])
                    .map(b => `<span class="tag">${b}</span>`).join('');
                document.getElementById('summary').innerText = `â€» ì´ ì¡°í•©ìœ¼ë¡œ ì„ íƒ ì‹œ, ë¯¸ë³´ìœ  ì¢…ê²° ê¸°ì§ˆ ${bestResult.score}ì¢… ì €ê²© ê°€ëŠ¥`;

            } catch (e) {
                console.error(e);
                alert("ë°ì´í„° ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. êµ¬ê¸€ ì‹œíŠ¸ ê²Œì‹œ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
            }
        }

        function parseCSV(csv) {
            const lines = csv.trim().split("\n");
            const headers = lines[0].split(",").map(h => h.trim().replace("\r", ""));
            return lines.slice(1).map(line => {
                const values = line.split(",").map(v => v.trim().replace("\r", ""));
                return headers.reduce((obj, header, i) => {
                    obj[header] = values[i];
                    return obj;
                }, {});
            });
        }
    </script>
</body>
</html>
